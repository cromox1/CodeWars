MORSE_CODE = {'..-.': 'F',
              '-..-': 'X',
              '...---...': 'SOS',
              '-.-.--': '!',
              '.--.': 'P',
              '-': 'T',
              '..---': '2',
              '.-.-.-': '.',
              '....-': '4',
              '-----': '0',
              '--...': '7',
              '...-': 'V',
              '-.-.': 'C',
              '.': 'E',
              '.---': 'J',
              '---': 'O',
              '-.-': 'K',
              '----.': '9',
              '..': 'I',
              '.-..': 'L',
              '.....': '5',
              '...--': '3',
              '-.--': 'Y',
              '-....': '6',
              '.--': 'W',
              '....': 'H',
              '-.': 'N',
              '.-.': 'R',
              '-...': 'B',
              '---..': '8',
              '--..': 'Z',
              '-..': 'D',
              '--.-': 'Q',
              '--.': 'G',
              '--': 'M',
              '..-': 'U',
              '.-': 'A',
              '...': 'S',
              '.----': '1'}

CODE_MORSE = {v:k for k,v in MORSE_CODE.items()}

####### MY CODE / SOLUTIONS

def onezerofirst(bits):
    bits = bits.strip('0')
    onefirst = bits.replace('0','#')
    zerofirst = ''
    if '#' in onefirst:
        if '#1' in onefirst:
            zerofirst = onefirst.split('#1')[0] + '#'
            if '1#' in zerofirst:
                zerofirst = (zerofirst.split('1#')[1] + '0').replace('#','0')
            else:
                zerofirst = zerofirst.replace('#', '0')
        else:
            zerofirst = onefirst.replace('1','').replace('#','0')
        onefirst = (onefirst.split('1#')[0] + '1').replace('#','')
    return onefirst, zerofirst

def ratiotouse(bits):
    bits = bits.strip('0')
    onezero = [i + 1 for i in range(len(bits) - 1) if bits[i] + bits[i + 1] == '10']
    zeroone = [i + 1 for i in range(len(bits) - 1) if bits[i] + bits[i + 1] == '01']
    onefirst = onezerofirst(bits)[0]
    zerofirst = onezerofirst(bits)[1]
    if len(bits) > 1:
        ratiolist = []
        if len(onezero) == len(zeroone) and len(onezero) >= 1 and len(zerofirst) <= len(onefirst) and len(zerofirst) > 0:
            if zeroone[0] > onezero[0]:
                ratiolist = [(zeroone[i] - onezero[i]) for i in range(len(onezero))]
            elif zeroone[0] < onezero[0]:
                ratiolist = [(onezero[i] - zeroone[i]) for i in range(len(onezero))]
            print(sorted(ratiolist))
            ratio = sorted(ratiolist)[0]
        elif len(zerofirst) == 0:
            ratio = len(onefirst)
        elif len(onefirst) < len(zerofirst):
            ratio = len(onefirst)
        else:
            ratio = 1
    else:
        ratio = 1
    return ratio

def decodeBitsAdvanced(bits):
    bits = bits.strip('0')
    print(bits)
    ratio = ratiotouse(bits)
    onezerocalc = onezerofirst(bits)
    lenzerofirst = len(onezerocalc[1])
    lenonefirst = len(onezerocalc[0])
    print('lenzerofirst = ', lenzerofirst, ' lenonefirst = ', lenonefirst)
    print('ratio = ', ratio)
    if (ratio > 1 and ratio >= lenzerofirst) or (ratio > 1 and ratio >= lenonefirst):
        newbits = ''
        for i in range(0, len(bits), ratio):
            newbits = newbits + bits[i]
        dots = newbits.replace('1' * 3, '-').replace('1', '.').replace('0' * 3, ' ').replace('0', '')
        return dots
    else:
        if len(bits) > 1:
            onezero = [i + 1 for i in range(len(bits) - 1) if bits[i] + bits[i + 1] == '10']
            zeroone = [i + 1 for i in range(len(bits) - 1) if bits[i] + bits[i + 1] == '01']
            if onezero != []:
                onezero_org = onezero + [len(bits)]
                zeroone_org = [0] + zeroone
                oneloccount = {zeroone_org[i]: onezero_org[i] - zeroone_org[i] for i in range(len(zeroone_org))}
                zeroloccount = {onezero[i]: zeroone[i] - onezero[i] for i in range(len(onezero))}
                sorted_one = list(dict.fromkeys(sorted(oneloccount.values())))
                sorted_zero = list(dict.fromkeys(sorted(zeroloccount.values())))
                print(sorted_zero)
                maxzero = sorted_zero[-1]
                print('maxzero = ', maxzero)
                if len(sorted_zero) > 20:
                    atas = 7*sorted_zero[-1]/12
                    bawah = sorted_zero[-1]/4
                elif 20 >= len(sorted_zero) > 6:
                    atas = sorted_zero[-1]/2 + 1.5
                    bawah = sorted_zero[3]
                elif len(sorted_zero) == 6:
                    atas = (sorted_zero[-2] + sorted_zero[-1])/2
                    bawah = (sorted_zero[2] + sorted_zero[3])/2
                elif 3 < len(sorted_zero) < 6:
                    atas = sorted_zero[-2]
                    bawah = (sorted_zero[1] + sorted_zero[2])/2
                elif len(sorted_zero) == 3:
                    atas = (sorted_zero[1] + sorted_zero[2])/2
                    bawah = (sorted_zero[0] + sorted_zero[1])/2
                elif 1 < len(sorted_zero) < 3:
                    atas = sorted_zero[2]
                    bawah = sorted_zero[1]
                elif len(sorted_zero) == 1:
                    bawah = 0
                    if sorted_zero[0] < 6:
                        atas = sorted_zero[0]
                    else:
                        atas = 5
                else:
                    atas = 0 ; bawah = 0
                if maxzero > 33:
                    atas = 30
                    bawah = 10
                # elif 33 > maxzero >= 3:
                #     atas = (2*maxzero/3)
                #     bawah = (maxzero/3)
                elif maxzero == 1:
                    atas = 3
                    bawah = 2
                divideone = sorted_one[-1] / 2
                dots = ''
                # print('# atas = ', atas, ' / bawah = ', bawah)
                for i in range(len(bits)):
                    # print('/ atas = ', atas, ' / bawah = ', bawah)
                    if i in oneloccount.keys():
                        if oneloccount[i] > divideone and oneloccount[i] >= 3:
                            dots = dots + '-'
                        else:
                            dots = dots + '.'
                    elif i in zeroloccount.keys():
                        print('zeroloccount = ', zeroloccount[i], ' / atas = ', atas, ' / bawah = ', bawah)
                        if zeroloccount[i] > atas and zeroloccount[i] > 3:
                            dots = dots + '  '
                        elif bawah < zeroloccount[i] <= atas:
                            dots = dots + ' '
                        else:
                            dots = dots + ''
                        # if maxzero == 1:
                        #     dots = dots + ' '
                return dots
            else:
                return '.'
        elif len(bits) == 1 and bits == '':
            return ''
        else:
            return bits.replace('1', '.').replace('0', '')

def decodeMorse(morse_code):
    print(morse_code)
    if morse_code != ' ' and morse_code != '':
        morse_code = morse_code.strip()
        text = ''
        for x in morse_code.split(' '):
            if x != '':
                text = text + MORSE_CODE[x]
            else:
                text = text + ' '
        return text.replace('  ', ' ')
    else:
        return ''

def encode_morse(sentences):
    sentences = sentences.strip()
    bits = ''
    for word in sentences.split(' '):
        for char in word:
            bits = bits + CODE_MORSE[char.upper()]
            bits = bits + ' '
        bits = bits + ' '
    return bits

########### TDD

class Test:
    def assert_equals(value, expected):
        from nose.tools import assert_equal
        try:
            assert_equal(value, expected)
            print('EQUAL   --> v =', value, " ==  x =", expected)
        except:
            # expecteddots = ''
            # for c in expected:
            #     expecteddots = expecteddots + ' ' + CODE_MORSE[c]
            print("Got = {} / len = {} , Expected = {} / len = {}".format(value, len(value), expected, len(expected)), ' -- > ', encode_morse(expected))
            print('UNEQUAL!! --> v =', value, " !=  x =", expected)

    @classmethod
    def describe(cls, param):
        print(param)

###########
### TEST DATA

bit1 = '1' ; exp1 = 'E'
bit2 = '101' ; exp2 = 'I'
bit3 = '10001'; exp3 = 'EE'
bit4 = '10111' ; exp4 = 'A'
bit5 = '10111' ; exp5 = 'A'
bit6 = '1110111' ; exp6 = 'M'
bit7 = '111' ; exp7 = 'E'
bit8 = '1111111' ; exp8 = 'E'
bit9 = '111000111' ; exp9 = 'I'
bit10 = '111110000011111' ; exp10 = 'I'
bit11 = '111000000000111' ; exp11 = 'EE'
bit12 = '01110'; exp12 = 'E'

bit13 = '1100110011001100000011000000111111001100111111001111110000000000000011001111110011111100111111000000110011001111110000001111110011001100000011'
exp13 = 'HEY JUDE'

bit14 = '111111000000111111000000111111000000111111000000000000000000111111000000000000000000111111111111111111000000111111000000111111111111111111000000111111111111111111000000000000000000000000000000000000000000111111000000111111111111111111000000111111111111111111000000111111111111111111000000000000000000111111000000111111000000111111111111111111000000000000000000111111111111111111000000111111000000111111000000000000000000111111'
exp14 = 'HEY JUDE'

bit15 = '00011100010101010001000000011101110101110001010111000101000111010111010001110101110000000111010101000101110100011101110111000101110111000111010000000101011101000111011101110001110101011100000001011101110111000101011100011101110001011101110100010101000000011101110111000101010111000100010111010000000111000101010100010000000101110101000101110001110111010100011101011101110000000111010100011101110111000111011101000101110101110101110'
exp15 = 'THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG.'

bit16 = '11111111111111100000000000000011111000001111100000111110000011111000000000000000111110000000000000000000000000000000000011111111111111100000111111111111111000001111100000111111111111111000000000000000111110000011111000001111111111111110000000000000001111100000111110000000000000001111111111111110000011111000001111111111111110000011111000000000000000111111111111111000001111100000111111111111111000000000000000000000000000000000001111111111111110000011111000001111100000111110000000000000001111100000111111111111111000001111100000000000000011111111111111100000111111111111111000001111111111111110000000000000001111100000111111111111111000001111111111111110000000000000001111111111111110000011111000000000000000000000000000000000001111100000111110000011111111111111100000111110000000000000001111111111111110000011111111111111100000111111111111111000000000000000111111111111111000001111100000111110000011111111111111100000000000000000000000000000000000111110000011111111111111100000111111111111111000001111111111111110000000000000001111100000111110000011111111111111100000000000000011111111111111100000111111111111111000000000000000111110000011111111111111100000111111111111111000001111100000000000000011111000001111100000111110000000000000000000000000000000000011111111111111100000111111111111111000001111111111111110000000000000001111100000111110000011111000001111111111111110000000000000001111100000000000000011111000001111111111111110000011111000000000000000000000000000000000001111111111111110000000000000001111100000111110000011111000001111100000000000000011111000000000000000000000000000000000001111100000111111111111111000001111100000111110000000000000001111100000111111111111111000000000000000111111111111111000001111111111111110000011111000001111100000000000000011111111111111100000111110000011111111111111100000111111111111111000000000000000000000000000000000001111111111111110000011111000001111100000000000000011111111111111100000111111111111111000001111111111111110000000000000001111111111111110000011111111111111100000111110000000000000001111100000111111111111111000001111100000111111111111111000001111100000111111111111111'
exp16 = 'THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG.'

# ############# TESTING
#
# inputlist = [bit1, bit2, bit3, bit4, bit5, bit6, bit7, bit8, bit9, bit10, bit11, bit12, bit13, bit14, bit15, bit16]
# expctlist = [exp1, exp2, exp3, exp4, exp5, exp6, exp7, exp8, exp9, exp10, exp11, exp12, exp13, exp14, exp15, exp16]
#
# for i in range(len(inputlist)):
#     print(i+1, ') ', end='')
#     Test.assert_equals(decode_morse(decode_bits(inputlist[i])), expctlist[i])

bit17 = '0000000011011010011100000110000001111110100111110011111100000000000111011111111011111011111000000101100011111100000111110011101100000100000'
exp17 = 'HEY JUDE'

bit18 = '0'
exp18 = ''

bit19 = '000000000000000000000000000000000000000000'
exp19 = ''

bit20 = '1001'; exp20 = 'EE'
bit21 = '100001'; exp21 = 'EE'
bit22 = '10000001'; exp22 = 'E E'
bit23 = '10000000001'; exp23 = 'E E'

bit24 = '00000000000111111100000011010001110111000000001110000000000000000001111111011111100001101111100000111100111100011111100000001011100000011111110010001111100110000011111100101111100000000000000111111100001111010110000011000111110010000011111110001111110011111110000010001111110001111111100000001111111101110000000000000010110000111111110111100000111110111110011111110000000011111001011011111000000000000111011111011111011111000000010001001111100000111110111111110000001110011111100011111010000001100001001000000000000000000111111110011111011111100000010001001000011111000000100000000101111101000000000000011111100000011110100001001100000000001110000000000000001101111101111000100000100001111111110000000001111110011111100011101100000111111000011011111000111111000000000000000001111110000100110000011111101111111011111111100000001111110001111100001000000000000000000000000000000000000000000000000000000000000'
exp24 = 'THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG'

bit25 = '11111000001111111000011111100000111111111111111000011111111111111000000111111111111111100001110000011111100000001111000000000000000011111111111111000000111110000011111111111111100000011110000011111111111111100001111111111111110000000000000000000000000000000000011111111111111110000000000000001111000000111110000011110000000111100000000000000111110000000000000000000000000000000000011111111111111100000111111111111111000011111000001111111111111100000000000000001111111000000111111000000011111111111111000000000000000011110000001111100000000000000011111111111111100000111111000111111111111111000011110000000000000000111111111111110000000111100000111111111111110000000000000000000000000000000000011111111111111100000111111000011111000000111110000000000000001111110000111111111111111100000011110000000000000011111111111111100001111111111111110000111111111111110000000000000001111100000001111111111111110000000111111111111111110000000000000000111111111111111000001111100000000000000000000000000000000000011110001111100000011111111111111110000011100000000000000011111111111111110000011111111111110000001111111111111111000000000000001111111111111110000001111100001111110000001111111111111111000000000000000000000000000000000011110000011111111111111100000011111111111111100001111111111111111000000000000001111110001111000011111111111100000000000000001111111111111100000011111111111111100000000000000110000011111111111111100000111111111111111100000111110000000000000001111110000111110000111111000000000000000000000000000000000011111111111111110001111111111111111000001111111111111111000000000000000111100000111110000111100000111111111111111000000000000000111111000000000000000111000000111111111111111000111100000000000000000000000000000000000011111111111111100000000000000011111110000111100000111111000001111110000000000000001111110000000000000000000000000000000000000111111000111111111111111100000111100000011111110000000000000011110000111111111111111000000000000011111111111111000001111111111111111000001111100001111100000000000000011111111111111000001111110000011111111111111111000011111111111111100000000000000000000000000000000000001111111111111111000001111110000011110000000000000111111111111111000001111111111111111000011111111111111110000000000000001111111111111100000011111111111111100000111100000000000000011111100000111111111111110000001110000011111111111111110000011111000011111111111111'
exp25 = 'SOS! THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG.'

bit26 = '00000000000000011111111000000011111111111100000000000111111111000001111111110100000000111111111111011000011111111011111111111000000000000000000011111111110000110001111111111111000111000000000001111111111110000111111111100001100111111111110000000000111111111111011100001110000000000000000001111111111010111111110110000000000000001111111111100001111111111110000100001111111111111100000000000111111111000000011000000111000000000000000000000000000011110001111100000111100000000111111111100111111111100111111111111100000000011110011111011111110000000000000000000000111111111110000000011111000000011111000000001111111111110000000001111100011111111000000000111111111110000011000000000111110000000111000000000011111111111111000111001111111111001111110000000000000000000001111000111111111100001111111111111100100000000001111111100111111110111111110000000011101111111000111000000001001111111000000001111111111000000000111100001111111000000000000011111111100111111110111111111100000000000111111110000001100000000000000000000111111101010000010000001111111100000000011111000111111111000000111111111110011111111001111111110000000011000111111110000111011111111111100001111100001111111100000000000011110011101110001000111111110000000001111000011111110010110001111111111000000000000000000111111111110000000100000000000000000011110111110000001000011101110000000000011111111100000011111111111100111111111111000111111111000001111111100000000000001110111111111111000000110011111111111101110001111111111100000000111100000111100000111111111100000111111111111000000011111111000000000001000000111100000001000001111100111111111110000000000000000000010001111111100000011111111100000000000000100001111111111110111001111111111100000111111100001111111111000000000000000000000000011100000111111111111011110000000010000000011111111100011111111111100001110000111111111111100000000000000111110000011111001111111100000000000011100011100000000000011111000001111111111101000000001110000000000000000000000000000111110010000000000111111111000011111111110000000000111111111111101111111111100000000010000000000000011111111100100001100000000000000111100111100000000001100000001111111111110000000011111111111000000000111100000000000000000000111101111111111111000000000001111000011111000011110000000001100111111100111000000000100111000000000000111110000010000011111000000000000001111111111100000000110111111111100000000000000111111111111100000111000000000111111110001111000000111111110111111000000001111000000000010000111111111000011110001111111110111110000111111111111000000000000000000000000111111111110000000111011111111100011111110000000001111111110000011111111100111111110000000001111111111100111111111110000000000110000000000000000001000011111111110000000001111111110000000000000000000000011111111111111000000111111111000001111111110000000000111111110000010000000011111111000011111001111111100000001110000000011110000000001011111111000011111011111111110011011111111111000000000000000000100011111111111101111111100000000000000001100000000000000000011110010111110000000011111111100000000001111100011111111111101100000000111110000011110000111111111111000000001111111111100001110111111111110111000000000011111111101111100011111111110000000000000000000000000010000111111111100000000001111111110111110000000000000000000000110000011110000000000001111111111100110001111111100000011100000000000111110000000011111111110000011111000001111000110000000011100000000000000111100001111111111100000111000000001111111111000000111111111100110000000001111000001111111100011100001111111110000010011111111110000000000000000000111100000011111000001111000000000111111001110000000011111111000100000000000011111111000011001111111100000000000110111000000000000111111111111000100000000111111111110000001111111111011100000000000000000000000000'
exp26 = 'MGY CQD CQD SOS TITANIC POSITION 41.44 N 50.24 W. REQUIRE IMMEDIATE ASSISTANCE. COME AT ONCE. WE STRUCK AN ICEBERG. SINKING'

# input1 = bit24
# expect1 = exp24
# # input1 = bit13
# # expect1 = exp13
# print(input1)
# print('dots = ', decode_bits(input1))
# Test.assert_equals(decode_morse(decode_bits(input1)), expect1)
# print('expect = ', expect1)
# print('exp dots = ', encode_morse(expect1))

# inputlist = [bit1, bit2, bit3, bit4, bit5, bit6, bit7, bit8, bit9, bit10, bit11, bit12, bit13, bit14, bit15, bit16, bit17, bit18, bit19, bit20, bit21, bit22, bit23, bit24, bit25, bit26]
# expctlist = [exp1, exp2, exp3, exp4, exp5, exp6, exp7, exp8, exp9, exp10, exp11, exp12, exp13, exp14, exp15, exp16, exp17, exp18, exp19, exp20, exp21, exp22, exp23, exp24, exp25, exp26]

# inputlist = [bit11, bit17, bit21, bit24]
# expctlist = [exp11, exp17, exp21, exp24]

# inputlist = [bit11, bit17]
# expctlist = [exp11, exp17]

# for i in range(len(inputlist)):
#     print(i+1, ') ', end='')
#     Test.assert_equals(decodeMorse(decodeBitsAdvanced(inputlist[i])), expctlist[i])

input1 = bit26
expect1 = exp26
# print(input1)
# print('dots = ', decodeBitsAdvanced(input1))
# print('expect = ', expect1)

Test.assert_equals(decodeMorse(decodeBitsAdvanced(input1)), expect1)
print('exp dots = ', encode_morse(expect1))

